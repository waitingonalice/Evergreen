generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                  String                @id @default(uuid())
  email               String                @unique
  password            String                @db.VarChar(255)
  firstName           String
  lastName            String
  country             String
  active              Boolean               @default(false)
  previousCurrency    Currency?
  currency            Currency              @default(USD)
  updatedAt           DateTime              @updatedAt
  createdAt           DateTime              @default(now())
  transactions        Transaction[]
  balanceHistory      BalanceHistory[]
  transactionSchedule TransactionSchedule[]
}

model BalanceHistory {
  id        Int      @id @default(autoincrement())
  account   Account  @relation(fields: [accountId], references: [id])
  accountId String
  total     Decimal  @default(0)
  createdAt DateTime @default(now())
}

model Transaction {
  id                Int             @id @default(autoincrement())
  account           Account         @relation(fields: [accountId], references: [id])
  accountId         String
  transactionData   TransactionData @relation(fields: [transactionDataId], references: [id])
  transactionDataId Int             @unique
}

// used for billing payment
model TransactionSchedule {
  id                Int             @id @default(autoincrement())
  frequency         String
  nextRun           Int
  account           Account         @relation(fields: [accountId], references: [id])
  accountId         String
  transactionData   TransactionData @relation(fields: [transactionDataId], references: [id])
  transactionDataId Int             @unique
}

// 3NF table for transaction and transactionSchedule
model TransactionData {
  id                  Int                  @id @default(autoincrement())
  transaction         Transaction?
  transactionSchedule TransactionSchedule?
  title               String
  description         String?
  amount              Decimal
  category            String
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
}

enum Currency {
  SGD
  USD
}
