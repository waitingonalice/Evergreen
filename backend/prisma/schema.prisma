generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id             String           @id @default(uuid())
  email          String           @unique
  password       String           @db.VarChar(255)
  firstName      String
  lastName       String
  country        String
  active         Boolean          @default(false)
  updatedAt      DateTime         @updatedAt
  createdAt      DateTime         @default(now())
  transactions   Transaction[]
  balanceHistory BalanceHistory[]
  profile        Profile?
}

model Profile {
  id             Int      @id @default(autoincrement())
  Account        Account  @relation(fields: [accountId], references: [id])
  accountId      String   @unique
  baseCurrency   Currency @default(SGD)
  profilePicture String?
  updatedAt      DateTime @updatedAt
}

model BalanceHistory {
  id           Int      @id @default(autoincrement())
  account      Account  @relation(fields: [accountId], references: [id])
  accountId    String
  total        Decimal  @default(0)
  totalIncome  Decimal  @default(0)
  totalExpense Decimal  @default(0)
  currency     Currency @default(SGD)
  createdAt    DateTime @default(now())
}

model Transaction {
  id                    Int                  @id @default(autoincrement())
  title                 String               @db.VarChar(300)
  description           String?              @db.VarChar(800)
  amount                Decimal
  category              String
  type                  TransactionType
  recurring             Boolean              @default(false) // to be used for billing payments
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  account               Account              @relation(fields: [accountId], references: [id])
  accountId             String
  transactionSchedule   TransactionSchedule? @relation(fields: [transactionScheduleId], references: [id])
  transactionScheduleId Int?
}

// used for billing payment
model TransactionSchedule {
  id          Int           @id @default(autoincrement())
  frequency   String
  nextRun     Int
  transaction Transaction[]
}

enum Currency {
  SGD
  USD
}

enum TransactionType {
  INCOME
  EXPENSE
}
